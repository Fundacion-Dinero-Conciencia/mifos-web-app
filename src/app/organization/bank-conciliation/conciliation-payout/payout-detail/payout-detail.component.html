<div class="container">
  <!-- Top: Volver -->
  <div fxLayout="row" fxLayoutAlign="end center" class="m-b-15">
    <button class="outlinedButton" mat-button [routerLink]="['../../']">Volver</button>
  </div>

  <!-- Título -->
  <div class="m-b-10">
    <h2 class="bc-title bc-title--section">Orden de pago</h2>
    <p>Pagaré #{{ orderInfo.documentNumber }} - Subcrédito {{ orderInfo.subCreditAccountNo }}</p>
    <p>Estado: {{ getPayrollStatus(orderInfo) }}</p>
  </div>

  <!-- Info box -->
  <div class="infoBox m-b-20" fxLayout="row" fxLayoutAlign="start start" fxLayoutGap="10px">
    <span class="infoBox__icon">ⓘ</span>
    <div class="infoBox__content">
      <div class="infoBox__title">Detalle de nómina</div>
      <div class="infoBox__text">
        La nómina de pago ha sido generada con {{ totalItems }}
        {{ totalItems === 1 ? 'inversion' : 'inversiones' }} dando un total de
        {{ orderInfo.amount | currency: currency }}.
      </div>
    </div>
  </div>

  <!-- Search -->
  <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="16px" class="m-b-10">
    <mat-form-field class="inputSearch" fxFlex="50%">
      <mat-label>Buscar por nombre o RUT de inversionista</mat-label>
      <input matInput type="text" (input)="onSearchInput($any($event.target).value)" />
      <button mat-icon-button matSuffix aria-label="Buscar">
        <mat-icon>search</mat-icon>
      </button>
    </mat-form-field>
  </div>

  <!-- Tabla principal -->
  <div class="bc-table mat-elevation-z0">
    <table mat-table [dataSource]="dataSource" class="bc-table__table">
      <!-- ID -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>ID</th>
        <td mat-cell *matCellDef="let row">
          {{ row.id }}
        </td>
      </ng-container>

      <!-- Inversionista -->
      <ng-container matColumnDef="investor">
        <th mat-header-cell *matHeaderCellDef>Inversionista</th>
        <td mat-cell *matCellDef="let row">
          {{ row.investorName }}
        </td>
      </ng-container>

      <!-- RUT -->
      <ng-container matColumnDef="rut">
        <th mat-header-cell *matHeaderCellDef>RUT</th>
        <td mat-cell *matCellDef="let row">
          {{ row.rut }}
        </td>
      </ng-container>

      <!-- Participación -->
      <ng-container matColumnDef="participation">
        <th mat-header-cell *matHeaderCellDef>Participación</th>
        <td mat-cell *matCellDef="let row">{{ row.percentageShare | number: '1.0-2' }}%</td>
      </ng-container>

      <!-- Monto cuota a pagar -->
      <ng-container matColumnDef="installmentAmount">
        <th mat-header-cell *matHeaderCellDef>Monto cuota a pagar</th>
        <td mat-cell *matCellDef="let row">
          {{ row.amount | currency: currency }}
        </td>
      </ng-container>

      <!-- Monto a pagar -->
      <ng-container matColumnDef="amountToPay">
        <th mat-header-cell *matHeaderCellDef>Monto a pagar</th>
        <td mat-cell *matCellDef="let row">
          {{ row.amountToPaid | currency: currency }}
        </td>
      </ng-container>

      <!-- Monto a reinvertir -->
      <ng-container matColumnDef="amountToReinvest">
        <th mat-header-cell *matHeaderCellDef>Monto a reinvertir</th>
        <td mat-cell *matCellDef="let row">
          {{ row.amountToReinvest | currency: currency }}
        </td>
      </ng-container>

      <!-- Estado -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Estado</th>
        <td mat-cell *matCellDef="let row">
          <span
            class="status-dot"
            [ngClass]="{
              'status-green': row.conciliationStatus?.value === 'ACCEPTED',
              'status-red': row.conciliationStatus?.value === 'REJECTED',
              'status-yellow': row.conciliationStatus?.value === 'PENDING'
            }"
          ></span>
          {{ 'labels.status.' + capitalize(row.conciliationStatus?.value) | translate }}
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell mat-cell_empty" [attr.colspan]="displayedColumns.length">
          <div class="alert">
            <div class="message">
              <i class="fa fa-exclamation-circle alert-check"></i>
              No se encontraron registros para mostrar
            </div>
          </div>
        </td>
      </tr>
    </table>

    <mat-paginator
      [length]="totalItems"
      [pageSize]="pageSize"
      [pageIndex]="pageIndex"
      [pageSizeOptions]="[5, 10, 25, 50]"
      showFirstLastButtons
      (page)="onPageChange($event)"
    ></mat-paginator>
  </div>
</div>
